	<!doctype html>
	<!--[if !IE]>
	<html class="no-js non-ie" lang="en-US"> <![endif]-->
	<!--[if IE 7 ]>
	<html class="no-js ie7" lang="en-US"> <![endif]-->
	<!--[if IE 8 ]>
	<html class="no-js ie8" lang="en-US"> <![endif]-->
	<!--[if IE 9 ]>
	<html class="no-js ie9" lang="en-US"> <![endif]-->
	<!--[if gt IE 9]><!-->
<html class="no-js" lang="en-US"> <!--<![endif]-->
	<head>
<base href="/archive" />


		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		
		

		<title>On Sharding Graph Databases &#8211; World Wide Webber</title>




<link rel='stylesheet' id='responsive-style-css'  href='/archive/contents/ui/theme/core/css/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='responsive-media-queries-css'  href='/archive/contents/ui/theme/core/css/responsive.css' type='text/css' media='all' />
<link rel='stylesheet' id='fontawesome-style-css'  href='/archive/contents/ui/theme/core/css/font-awesome.min.css' type='text/css' media='all' />
<script type='text/javascript' src='/archive/inc/js/jquery/jquery.js'></script>
<script type='text/javascript' src='/archive/inc/js/jquery/jquery-migrate.min.js'></script>
<script type='text/javascript' src='/archive/contents/ui/theme/core/js/responsive-modernizr.min.js'></script>








	<script>
		jQuery(document).ready(function(){
		var copyright_text = "";
		var cyberchimps_link = "";
		var siteurl = "/archive"; 
		if(copyright_text == "")
		{
			jQuery(".copyright #copyright_link").text(" "+"Default copyright text");
		}
		else{ 
			jQuery(".copyright #copyright_link").text(" "+copyright_text);
		}
		jQuery(".copyright #copyright_link").attr('href',siteurl);
		if(cyberchimps_link == 1)
		{
			jQuery(".powered").css("display","block");
		}
		else{
			jQuery(".powered").css("display","none");
		}
		});
	</script>
<!-- We need this for debugging -->
<!-- Responsive 3.11 -->
		<style type="text/css" id="wp-custom-css">
			1		</style>
		</head>

<body class="post-template-default single single-post postid-126 single-format-standard default-layout">

  	
<div id="container" class="hfeed">

	<div class="skip-container cf">
		<a class="skip-link screen-reader-text focusable" href="#content">&darr; Skip to Main Content</a>
	</div><!-- .skip-container -->
	<div id="header_section">
	<div id="header" role="banner">

		
		
		
		
				<div id="content-outer">
			<div id="logo">
				<span class="site-name"><a href="/archive/" title="World Wide Webber" rel="home">World Wide Webber</a></span>
				<span class="site-description">Jim Webber&#039;s Blog</span>
			</div><!-- end of #logo -->
		</div>
				
				<div class="main-nav"><ul class="menu"><li ><a href="/archive/">Home</a></li><li class="page_item page-item-95 current_page_parent"><a href="/archive/blog/">Blog</a></li><li class="page_item page-item-5 page_item_has_children"><a href="/archive/biography/">Bio</a><ul class='children'><li class="page_item page-item-10"><a href="/archive/biography/shortbio/">Short Bio</a></li></ul></li><li class="page_item page-item-630"><a href="/archive/books/">Books</a></li><li class="page_item page-item-15"><a href="/archive/contact/">Contact</a></li><li class="page_item page-item-13"><a href="/archive/professional/">Professional</a></li><li class="page_item page-item-12"><a href="/archive/publications/">Publications</a></li></ul></div>
		
		
	</div><!-- end of #header -->
	</div>


	  
	<div id="wrapper" class="clearfix">
<div id="content-outer">
<div id="content" class="grid col-620" role="main">

	
	
		
						<div id="post-126" class="post-126 post type-post status-publish format-standard hentry category-neo4j category-nosql">
				
				
	<h1 class="entry-title post-title responsive">On Sharding Graph Databases</h1>

<div class="post-meta">
	<i class="fa fa-calendar" aria-hidden="true"></i><span class="meta-prep meta-prep-author posted">Posted on </span><a href="/archive/2011/02/on-sharding-graph-databases/" title="On Sharding Graph Databases" rel="bookmark"><time class="timestamp updated" datetime="2011-02-16T15:08:31+00:00">February 16, 2011</time></a><span class="byline"> by </span><span class="author vcard"><a class="url fn n" href="/archive/author/jim/" title="View all posts by jim"><span class="author-gravtar"></span>jim</a></span>		<span class='posted-in'>
Posted in <a href="/archive/category/neo4j/">neo4j</a>, <a href="/archive/category/nosql/">NOSQL</a>		</span>

			<span class="comments-link">
		<span class="mdash">&mdash;</span>
			<a href="/archive/2011/02/on-sharding-graph-databases/#respond">No Comments &darr;</a>		</span>
	</div><!-- end of .post-meta -->

				<div class="post-entry">
					<p>One of the substantial benefits of the family of <a href="http://en.wikipedia.org/wiki/NoSQL">NOSQL</a> (Not only SQL) databases is their tendency to be able to scale predictably. One of the key elements to being able to scale NOSQL databases is <a href="http://en.wikipedia.org/wiki/Shard_%28database_architecture%29">sharding</a>, where a large dataset can be broken up and distributed across a number of (typically replicated) shards. For simple data models like Key-Value, Column-family, and Document databases this is a sensible solution. In such stores, the key to retrieve any item stored is well known and stable, while the lookup mechanism is both predictable (e.g. consistent hashing) and rapid (e.g. using Bloom filters to statistically locate a hot replica). Given those conditions, it&#8217;s straightforward for a client looking to store or retrieve data to be directed to an appropriate shard.</p>
<p>Unfortunately for graph databases like <a href="http://neo4j.org/">Neo4j</a>, sharding isn&#8217;t straightforward at all, leaving most solutions with a bit of a scaling headache. Unlike other classes of NOSQL database, a graph doesn&#8217;t have predictable lookup since it is a highly mutable structure. Worse, there are competing requirements when sharding a graph across physical Neo4j instances. For example, we want to co-locate related nodes for traversal performance, but we don&#8217;t want to place so many connected nodes on the same database that it becomes heavily loaded.</p>
<p><a href="http://jimwebber.org/2011/02/on-sharding-graph-databases/1-3/" rel="attachment wp-att-626"><img class="alignnone size-medium wp-image-626" alt="1" src="http://jimwebber.org/contents/data/2011/02/11-300x220.png" width="300" height="220" srcset="/archive/contents/data/2011/02/11-300x220.png 300w, /archive/contents/data/2011/02/11.png 891w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>The opposite is also true, that we don&#8217;t want too widely connected nodes across different database instances since it will incur a substantial performance penalty at runtime as traversals cross the (relatively latent) network.</p>
<p><a href="http://jimwebber.org/2011/02/on-sharding-graph-databases/2-3/" rel="attachment wp-att-627"><img class="alignnone size-medium wp-image-627" alt="2" src="http://jimwebber.org/contents/data/2011/02/21-300x220.png" width="300" height="220" srcset="/archive/contents/data/2011/02/21-300x220.png 300w, /archive/contents/data/2011/02/21.png 931w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>Given that a naive solution will lead to hotspots causing contention for local resources, or incur many network hops as the graph is traversed thus substantially increasing query time, we need to look for a better approach. The holy grail of <a href="http://alexaverbuch.blogspot.com/2010/04/me-my-names-alex-im-currently.html">graph algorithms</a> is to balance a graph across database instances by creating a minimum point cut for a graph, where graph nodes are placed such that there are few relationships that span shards.</p>
<p><a href="http://jimwebber.org/2011/02/on-sharding-graph-databases/3-3/" rel="attachment wp-att-628"><img class="alignnone size-medium wp-image-628" alt="3" src="http://jimwebber.org/contents/data/2011/02/31-300x229.png" width="300" height="229" srcset="/archive/contents/data/2011/02/31-300x229.png 300w, /archive/contents/data/2011/02/31.png 997w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>The trouble with this picture is that it&#8217;s hard to achieve in practice, especially since connected graphs can mutate rapidly and unpredictably at runtime. We can help to maintain a balanced graph by applying domain-specific knowledge to place nodes on shards; we can use insert-time algorithms to help us select the most appropriate shard to place a node; and we can use re-balancing algorithms periodically (sort of like a graph defrag) to help maintain a good node-to-shard mapping at runtime. We can also keep heuristic information on which relationships are traversed most frequently and optimise around those. However, as you might guess, much of this is an ongoing research problem and <a href="http://neo4j.org/">our community</a> and <a href="http://neotechnology.com/">customers</a> have pressing needs to scale even while diligent computer scientists and mathematicians are working towards ever better graph algorithms. So, in the meantime, the Neo4j team has observed a pattern that we&#8217;re calling &#8220;cache sharding&#8221; to help solve the problem of efficiently querying large datasets with graph databases, which Iâ€™ll cover in my next posting.</p>

					
									</div><!-- end of .post-entry -->

				<div class="navigation">
					<div class="previous">&#8249; <a href="/archive/2011/02/upcoming-talks/" rel="prev">Upcoming Talks</a></div>
					<div class="next"><a href="/archive/2011/02/cfp-ecows-2011-the-9th-ieee-european-conference-on-web-services/" rel="next">CFP: ECOWS 2011 &#8211; The 9th IEEE European Conference on Web Services</a> &#8250;</div>
				</div><!-- end of .navigation -->

				
	<div class="post-data">
			</div><!-- end of .post-data -->

<div class="post-edit"></div>
							</div><!-- end of #post-126 -->
			
						




		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2011/02/on-sharding-graph-databases/#respond" style="display:none;">Cancel reply</a></small></h3>			<form action="/archive/wp-comments-post.php" method="post" id="commentform" class="comment-form">
				<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name</label> <span class="required">*</span><input id="author" name="author" type="text" value="" size="30" /></p>
<p class="comment-form-email"><label for="email">E-mail</label> <span class="required">*</span><input id="email" name="email" type="text" value="" size="30" /></p>
<p class="comment-form-url"><label for="url">Website</label><input id="url" name="url" type="text" value="" size="30" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='126' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="53cf82bb28" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="146"/></p>			</form>
			</div><!-- #respond -->
	

			
		
</div><!-- end of #content -->


	<div id="widgets" class="grid col-300 fit" role="complementary">
		
		<div id="text-7" class="widget-wrapper widget_text">			<div class="textwidget"><div>
<h4 align="center">Jim Webber's Books</h4>  

<p align="center">
<img alt="Graph Databases book cover" src="http://ecx.images-amazon.com/images/I/51JijeM8MAL.jpg" width="160" height="240" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

  
<p align="center">
<a href="http://www.amazon.com/gp/product/1449356265/ref=as_li_tf_il?ie=UTF8&camp=1634&creative=6738&creativeASIN=1449356265&linkCode=as2&tag=jimwebbesblog-21">Amazon (US)</a>  
<br/>
<a href="http://www.amazon.co.uk/gp/product/1449356265/ref=as_li_tf_il?ie=UTF8&camp=1634&creative=6738&creativeASIN=1449356265&linkCode=as2&tag=jimwebbesblog-21">Amazon (UK)</a>
</p>


<p align="center"><img alt="REST in Practice book cover" src="http://akamaicovers.oreilly.com/images/9780596805838/lrg.jpg" width="160" height="240" /></p>
<p align="center"><a href="http://www.amazon.com/gp/product/0596805829?ie=UTF8&amp;tag=jimwebbesblog-20&amp;linkCode=xm2&amp;camp=1789&amp;creativeASIN=0596805829">Amazon (US)</a>
<br/>
<a href="http://www.amazon.co.uk/gp/product/0596805829?ie=UTF8&amp;tag=jimwebbesblog-21&amp;linkCode=xm2&amp;camp=1634&amp;creativeASIN=0596805829">Amazon (UK)</a></p>

<p align="center"><img alt="Developing Enterprise Web Services book cover" src="https://images-na.ssl-images-amazon.com/images/I/51ojvewjoHL._SX387_BO1,204,203,200_.jpg" width="160" height="240" /></p>
<p align="center"><a href="http://www.amazon.com/gp/product/B005MZDYRE?ie=UTF8&amp;tag=jimwebbesblog-20&amp;linkCode=xm2&amp;camp=1789&amp;creativeASIN=B005MZDYRE">Amazon (US)</a>
<br/>
<a href="http://www.amazon.co.uk/gp/product/0131401602?ie=UTF8&amp;tag=jimwebbesblog-21&amp;linkCode=xm2&amp;camp=1634&amp;creativeASIN=0131401602">Amazon (UK)</a></p>
</div></div>
		</div>
			</div><!-- end of #widgets -->
</div>
</div><!-- end of #wrapper -->

	 
</div><!-- end of #container -->

<div id="footer" class="clearfix" role="contentinfo">
	
	<div id="footer-wrapper">
		
		 <!--   main-->
		
		<div id="content-outer">			
				</div>
		<div id="content-outer">
		<div class="grid col-940">

			<div class="grid col-540">
							</div><!-- end of col-540 -->

			<div class="grid col-380 fit">
				<ul class="social-icons"><li class="twitter-icon"><a href="http://twitter.com/jimwebber"><img src="/archive/contents/ui/theme/core/icons/twitter-icon.png" width="24" height="24" alt="Twitter"></a></li></ul><!-- .social-icons -->			</div><!-- end of col-380 fit -->

		</div><!-- end of col-940 -->
		
		<div class="grid col-300 copyright">
			&copy; 2018<a id="copyright_link" href="/archive/" title="World Wide Webber">
				World Wide Webber			</a>
		</div><!-- end of .copyright -->

		<div class="grid col-300 scroll-top"><!--<a href="#scroll-top" title="scroll to top">&uarr;</a>
		<div id="scroll-to-top"><span class="glyphicon glyphicon-chevron-up"></span></div>--></div>

		<div class="grid col-300 fit powered">
			<a href="http://cyberchimps.com/responsive-theme/" title="Responsive Theme" rel="noindex, nofollow">Responsive Theme</a>
			powered by <a href="http://wordpress.org/" title="WordPress">
				WordPress</a>
		</div><!-- end .powered -->
	</div>
		
	</div><!-- end #footer-wrapper -->

	</div><!-- end #footer -->
<div id="scroll" title="Scroll to Top" style="display: block;">Top<span></span></div>
<script type='text/javascript' src='/archive/contents/ui/theme/core/js/responsive-scripts.min.js'></script>
<script type='text/javascript' src='/archive/contents/ui/theme/core/js/jquery.placeholder.min.js'></script>
<script async="async" type='text/javascript' src='/archive/contents/lib/akismet/_inc/form.js'></script>
</body>
</html>
